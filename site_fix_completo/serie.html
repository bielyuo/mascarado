<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <title>S√©rie ‚Äî M√°scara Secreta</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="img/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --red: #c0152a; --red-glow: #ff2244;
      --dark: #080c10; --navy: #0d1520; --navy2: #111d2e;
      --silver: #a8b8cc; --white: #eef2f7;
    }
    html { scroll-behavior: smooth; }
    body { background: var(--dark); font-family: 'Rajdhani', sans-serif; color: var(--white); }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--dark); }
    ::-webkit-scrollbar-thumb { background: var(--red); border-radius: 3px; }

    /* NAVBAR */
    header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      background: linear-gradient(180deg, rgba(8,12,16,0.98) 0%, rgba(8,12,16,0.85) 100%);
      border-bottom: 1px solid rgba(192,21,42,0.35);
      backdrop-filter: blur(12px);
    }
    nav {
      max-width: 1200px; margin: 0 auto; padding: 0 2rem;
      height: 70px; display: flex; align-items: center; gap: 1.5rem;
    }
    .nav-back {
      display: flex; align-items: center; justify-content: center;
      width: 42px; height: 42px; border-radius: 8px;
      border: 1px solid rgba(192,21,42,0.5); color: var(--silver);
      text-decoration: none; transition: all 0.2s;
      background: rgba(192,21,42,0.08); flex-shrink: 0; font-size: 1.1rem;
    }
    .nav-back:hover { background: rgba(192,21,42,0.25); border-color: var(--red-glow); color: var(--white); }
    .nav-logo { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; }
    .nav-logo img { width: 36px; height: 36px; object-fit: contain; filter: drop-shadow(0 0 8px rgba(255,34,68,0.5)); }
    .nav-logo span {
      font-family: 'Orbitron', sans-serif; font-size: 0.9rem; font-weight: 900;
      letter-spacing: 0.1em; text-transform: uppercase;
      background: linear-gradient(90deg, #fff 0%, var(--silver) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .nav-sep { color: rgba(168,184,204,0.3); font-size: 1.2rem; }
    .nav-series-name {
      font-family: 'Orbitron', sans-serif; font-size: 0.78rem; font-weight: 700;
      letter-spacing: 0.1em; color: var(--red-glow); white-space: nowrap;
      overflow: hidden; text-overflow: ellipsis; max-width: 200px;
    }

    /* HERO BANNER */
    .serie-hero {
      padding-top: 70px; min-height: 65vh;
      display: flex; align-items: flex-end;
      position: relative; overflow: hidden;
    }
    .serie-hero-bg {
      position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(192,21,42,0.15) 0%, rgba(8,12,16,0.5) 100%);
      background-size: cover; background-position: center;
    }
    .serie-hero-bg::after {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(to top, var(--dark) 0%, rgba(8,12,16,0.4) 60%, transparent 100%);
    }
    .serie-hero-content {
      position: relative; z-index: 1;
      max-width: 1200px; margin: 0 auto; padding: 3rem 2rem;
      width: 100%;
    }
    .serie-badge {
      display: inline-block; padding: 3px 12px;
      background: rgba(192,21,42,0.25); border: 1px solid rgba(192,21,42,0.5);
      border-radius: 4px; font-size: 0.72rem; font-weight: 700;
      letter-spacing: 0.18em; text-transform: uppercase; color: var(--red-glow);
      margin-bottom: 0.85rem;
    }
    .serie-title {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(2rem, 5vw, 4rem); font-weight: 900;
      letter-spacing: 0.12em; line-height: 1.05;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #fff 30%, var(--red-glow) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .serie-desc {
      font-size: 1.05rem; color: var(--silver); line-height: 1.75;
      max-width: 650px; margin-bottom: 1.5rem;
    }
    .serie-meta { display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 2rem; }
    .meta-tag {
      padding: 0.25rem 0.8rem;
      background: rgba(192,21,42,0.12); border: 1px solid rgba(192,21,42,0.3);
      border-radius: 4px; font-size: 0.8rem; font-weight: 600;
      letter-spacing: 0.08em; color: var(--silver);
    }

    /* EPISODES SECTION */
    .episodes-section { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem 5rem; }
    .section-title {
      font-family: 'Orbitron', sans-serif; font-size: clamp(1.2rem, 2.5vw, 1.8rem);
      font-weight: 900; letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 0.4rem;
    }
    .ep-count-label { font-size: 0.82rem; color: var(--red); letter-spacing: 0.1em; font-weight: 700; margin-bottom: 0.3rem; display: block; }
    .section-line { width: 50px; height: 3px; background: var(--red); margin-bottom: 2.5rem; box-shadow: 0 0 10px rgba(255,34,68,0.5); }

    /* VIDEO GRID */
    .video-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap: 1.5rem; }
    .video-link-icon { position:absolute;top:.5rem;right:.5rem;background:rgba(0,0,0,.65);color:#fff;font-size:.8rem;padding:3px 7px;border-radius:4px;opacity:0;transition:opacity .2s; }
    .video-card:hover .video-link-icon { opacity:1; }
    .video-card { text-decoration:none; display:block; background: var(--navy); border: 1px solid rgba(192,21,42,0.2); border-radius: 10px; overflow: hidden; cursor: pointer; transition: all 0.25s; }
    .video-card:hover { border-color: rgba(255,34,68,.6); transform: translateY(-6px) scale(1.02); box-shadow: 0 20px 45px rgba(0,0,0,.5),0 0 25px rgba(192,21,42,.25); }
    .video-thumb { position: relative; width: 100%; aspect-ratio: 16/9; background: linear-gradient(135deg, rgba(192,21,42,0.2), rgba(13,21,32,0.9)); display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .video-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .video-thumb-placeholder { font-size: 3rem; opacity: 0.4; }
    .video-ep-badge { position: absolute; top: 10px; left: 10px; background: var(--red); font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em; padding: 3px 10px; border-radius: 4px; text-transform: uppercase; }
    .video-info { padding: 1rem 1.1rem 1.2rem; }
    .video-title { font-family: 'Orbitron', sans-serif; font-size: 0.8rem; font-weight: 700; letter-spacing: 0.06em; color: var(--white); margin-bottom: 0.3rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .video-ep-label { font-size: 0.85rem; color: var(--silver); }

    /* EMPTY */
    .empty-state { grid-column: 1/-1; text-align: center; padding: 5rem 2rem; color: rgba(168,184,204,0.3); }
    .empty-state-icon { font-size: 4rem; margin-bottom: 1rem; }
    .empty-state p { font-family: 'Orbitron', sans-serif; font-size: 0.85rem; letter-spacing: 0.15em; text-transform: uppercase; }

    /* PAGINA√á√ÉO */
    .page-btn {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      background: var(--navy); border: 1px solid rgba(192,21,42,0.2);
      border-radius: 6px; color: var(--silver);
      font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.88rem;
      cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .page-btn:hover { border-color: rgba(255,34,68,0.5); color: var(--white); background: rgba(192,21,42,0.15); }
    .page-btn.active { background: var(--red); border-color: var(--red); color: #fff; box-shadow: 0 0 12px rgba(192,21,42,0.5); }
    .page-btn.disabled { opacity: 0.3; cursor: default; pointer-events: none; }
    .page-btn.wide { width: auto; padding: 0 0.75rem; }

    /* MODAL PLAYER */
    .modal-overlay { display: none; position: fixed; inset: 0; z-index: 200; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); align-items: center; justify-content: center; padding: 1rem; }
    .modal-overlay.active { display: flex; }
    .video-modal-inner { background: var(--navy); border: 1px solid rgba(192,21,42,0.35); border-radius: 12px; width: 100%; max-width: 960px; animation: slideUp 0.3s ease; overflow: hidden; }
    .video-modal-header { padding: 1.1rem 1.5rem; border-bottom: 1px solid rgba(168,184,204,0.1); display: flex; align-items: center; justify-content: space-between; }
    .video-modal-title { font-family: 'Orbitron', sans-serif; font-size: 0.9rem; font-weight: 700; letter-spacing: 0.1em; }
    .video-ep-pill { display: inline-block; background: var(--red); font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em; padding: 3px 10px; border-radius: 4px; margin-left: 10px; vertical-align: middle; }
    .modal-close { background: none; border: none; color: var(--silver); font-size: 1.4rem; cursor: pointer; transition: color 0.2s; }
    .modal-close:hover { color: var(--red-glow); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }

    /* TOAST */
    .toast { position: fixed; bottom: 2rem; right: 2rem; z-index: 999; background: var(--navy); border-left: 3px solid var(--red); border-radius: 6px; padding: 0.9rem 1.3rem; font-size: 0.9rem; transform: translateX(120%); transition: transform 0.3s; max-width: 300px; }
    .toast.show { transform: translateX(0); }

    /* NOT FOUND */
    .not-found { text-align: center; padding: 10rem 2rem; }
    .not-found h1 { font-family: 'Orbitron', sans-serif; font-size: 2rem; color: var(--red-glow); margin-bottom: 1rem; }
    .not-found p { color: var(--silver); margin-bottom: 2rem; }
    .not-found a { color: var(--red-glow); text-decoration: none; font-weight: 700; }

    footer { text-align: center; padding: 2.5rem; color: rgba(168,184,204,0.4); font-size: 0.85rem; letter-spacing: 0.08em; border-top: 1px solid rgba(192,21,42,0.15); }

    /* SEASON TABS */
    .season-tab { padding:.55rem 1.2rem; border-radius:20px; border:1px solid rgba(168,184,204,.2); background:rgba(255,255,255,.04); color:var(--silver); font-family:'Orbitron',sans-serif; font-size:.68rem; font-weight:700; letter-spacing:.1em; cursor:pointer; transition:all .2s; }
    .season-tab:hover { border-color:rgba(192,21,42,.4); color:var(--white); }
    .season-tab.active { background:var(--red); border-color:var(--red); color:#fff; box-shadow:0 0 12px rgba(192,21,42,.4); }
  
.video-card { opacity:0; animation:fadeIn .5s ease forwards; }
@keyframes fadeIn { to { opacity:1; } }


.ep-badge, .video-ep-badge {
  background: rgba(192,21,42,0.15) !important;
  border: 1px solid rgba(192,21,42,0.35);
  color: #ff6b81 !important;
}

.video-ep-label {
  color: rgba(168,184,204,0.75) !important;
  font-weight: 600;
  letter-spacing: .05em;
}


.video-card {
  display: flex;
  flex-direction: column;
}

.video-info {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}


.ep-badge, .video-ep-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  left: auto;
  background: rgba(255,255,255,0.85) !important;
  color: #000 !important;
  border: none !important;
  font-weight: 700;
  letter-spacing: .08em;
}

.video-ep-label {
  color: rgba(168,184,204,0.75) !important;
  font-weight: 600;
}


.video-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr) !important;
  gap: 1.5rem;
}

@media (max-width: 900px) {
  .video-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}

@media (max-width: 600px) {
  .video-grid {
    grid-template-columns: 1fr !important;
  }
}

</style>
</head>
<body>

<!-- HEADER -->
<header>
  <nav>
    <a href="index.html" class="nav-back" title="Voltar">‚Üê</a>
    <a href="index.html" class="nav-logo">
      <img src="img/logo.png" alt="M√°scara Secreta" onerror="this.style.display='none'">
      <span>M√°scara Secreta</span>
    </a>
    <span class="nav-sep">‚Ä∫</span>
    <span class="nav-series-name" id="nav-series-name">S√©rie</span>
  </nav>
</header>

<!-- HERO -->
<div class="serie-hero" id="serie-hero">
  <div class="serie-hero-bg" id="serie-hero-bg"></div>
  <div class="serie-hero-content">
    <div class="serie-badge" id="serie-badge">S√©rie</div>
    <h1 class="serie-title" id="serie-title">Carregando...</h1>
    <p class="serie-desc" id="serie-desc"></p>
    <div class="serie-meta" id="serie-meta"></div>
  </div>
</div>

<!-- EPIS√ìDIOS -->
<div class="episodes-section">
  <h2 class="section-title">Epis√≥dios</h2>
  <span class="ep-count-label" id="ep-count">0 V√çDEOS</span>
  <div class="section-line"></div>
  <div class="video-grid" id="video-grid">
    <div class="empty-state"><div class="empty-state-icon">üé≠</div><p>Nenhum epis√≥dio ainda</p></div>
  </div>
  <div id="pagination" style="display:none;justify-content:center;align-items:center;gap:0.4rem;margin-top:2.5rem;flex-wrap:wrap"></div>
</div>

<footer><p>¬© 2025 M√°scara Secreta ¬∑ Todos os direitos reservados</p></footer>
<div class="toast" id="toast"></div>

<!-- MODAL PLAYER -->

<script>
  // ======== L√ä PAR√ÇMETRO DA URL ========
  const params   = new URLSearchParams(window.location.search);
  const seriesId = parseInt(params.get('id'));

  const allSeries = JSON.parse(localStorage.getItem('ms_series') || '[]');
  const allVideos = JSON.parse(localStorage.getItem('ms_videos') || '[]');

  const serie = allSeries[seriesId];

  if (!serie || isNaN(seriesId)) {
    document.body.innerHTML = `
      <div style="padding-top:70px">
        <div class="not-found">
          <h1>404</h1>
          <p>S√©rie n√£o encontrada.</p>
          <a href="index.html">‚Üê Voltar para a p√°gina inicial</a>
        </div>
      </div>`;
  } else {
    // ======== PREENCHE HERO ========
    document.title = serie.name + ' ‚Äî M√°scara Secreta';
    document.getElementById('nav-series-name').textContent = serie.name;
    document.getElementById('serie-title').textContent = serie.name;
    document.getElementById('serie-badge').textContent = serie.prefix || 'S√©rie';

    const desc = document.getElementById('serie-desc');
    if (serie.desc) {
      desc.textContent = serie.desc;
    } else {
      desc.style.display = 'none';
    }

    // Banner / imagem de fundo
    if (serie.banner || serie.defaultImg) {
      const bg = document.getElementById('serie-hero-bg');
      bg.style.backgroundImage = `url('${serie.banner || serie.defaultImg}')`;
      bg.style.backgroundSize  = 'cover';
      bg.style.backgroundPosition = 'center';
    }

    // Meta tags
    const meta = document.getElementById('serie-meta');
    const epVideos = allVideos.filter(v =>
      v.ep && v.ep.startsWith(serie.prefix + ' ') &&
      (v.title === serie.titleTemplate || v.title === serie.name)
    );
    meta.innerHTML = `
      <span class="meta-tag">üì∫ ${epVideos.length} Epis√≥dio${epVideos.length !== 1 ? 's' : ''}</span>
      ${serie.prefix ? `<span class="meta-tag">${serie.prefix}</span>` : ''}
    `;

    // ======== TEMPORADAS + EPIS√ìDIOS ========
    const PER_PAGE = 18;
    let currentPage = 1;
    let currentSeason = null;

    const seasons = [...new Set(epVideos.map(v => v.season || 1))].sort((a,b) => a-b);
    const hasSeasons = seasons.length > 1;

    // Atualiza meta com total de temporadas
    if (hasSeasons) {
      meta.innerHTML += '<span class="meta-tag">üóÇ ' + seasons.length + ' Temporada' + (seasons.length > 1 ? 's' : '') + '</span>';
    }

    function getFilteredEps() {
      if (!hasSeasons || currentSeason === null) return epVideos;
      return epVideos.filter(v => (v.season || 1) === currentSeason);
    }

    function renderSeasonTabs() {
      const existing = document.getElementById('season-tabs');
      if (existing) existing.remove();
      if (!hasSeasons) return;

      const tabs = document.createElement('div');
      tabs.id = 'season-tabs';
      tabs.style.cssText = 'display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:2rem';

      const makeTab = (label, season) => {
        const btn = document.createElement('button');
        btn.textContent = label;
        const isActive = season === currentSeason;
        btn.style.cssText = 'padding:.55rem 1.2rem;border-radius:20px;border:1px solid '
          + (isActive ? 'var(--red)' : 'rgba(168,184,204,.2)')
          + ';background:' + (isActive ? 'var(--red)' : 'rgba(255,255,255,.04)')
          + ';color:' + (isActive ? '#fff' : 'var(--silver)')
          + ';font-family:\'Orbitron\',sans-serif;font-size:.68rem;font-weight:700;letter-spacing:.1em;cursor:pointer;transition:all .2s';
        btn.onclick = function() {
          currentSeason = season;
          currentPage = 1;
          renderSeasonTabs();
          renderGrid();
        };
        return btn;
      };

      tabs.appendChild(makeTab('Todas', null));
      seasons.forEach(s => tabs.appendChild(makeTab('T' + s, s)));

      const grid = document.getElementById('video-grid');
      grid.parentElement.insertBefore(tabs, grid);
    }

    function renderGrid(page) {
      if (page !== undefined) currentPage = page;
      const grid     = document.getElementById('video-grid');
      const count    = document.getElementById('ep-count');
      const filtered = getFilteredEps();

      if (filtered.length === 0) {
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üé≠</div><p>Nenhum epis√≥dio ainda</p></div>';
        document.getElementById('pagination').style.display = 'none';
        count.textContent = '0 V√çDEOS';
        return;
      }

      const total    = Math.ceil(filtered.length / PER_PAGE);
      if (currentPage > total) currentPage = total;
      const start    = (currentPage - 1) * PER_PAGE;
      const pageVids = filtered.slice(start, start + PER_PAGE);

      count.textContent = filtered.length + ' V√çDEO' + (filtered.length !== 1 ? 'S' : '');

      grid.innerHTML = pageVids.map((v, i) => {
        const gi    = start + i;
        const thumb = v.img || serie.defaultImg || '';
        const badge = (v.ep || 'EP') + (hasSeasons ? ' ¬∑ T' + (v.season || 1) : '');
        return '<a class="video-card" href="' + (v.link||'#') + '" target="_blank" rel="noopener">'
          + '<div class="video-thumb">'
          + (thumb ? '<img src="'+thumb+'" onerror="this.outerHTML=\'<div class=\\\'video-thumb-placeholder\\\'>üé≠</div>\'">' : '<div class="video-thumb-placeholder">üé≠</div>')
          + '<span class="video-ep-badge">' + badge + '</span>'
          + ''
          + '</div><div class="video-info">'
          + '<div class="video-title">' + v.title + '</div>'
          + '<div class="video-ep-label">' + (v.ep || '') + '</div>'
          + '</div>'
          + '</a>';
      }).join('');

      renderPagination(total);
    }

    function renderPagination(totalPages) {
      const el = document.getElementById('pagination');
      if (totalPages <= 1) { el.style.display = 'none'; return; }
      el.style.display = 'flex';
      const p = currentPage;
      let h = '';
      h += '<button class="page-btn wide ' + (p===1?'disabled':'') + '" onclick="renderGrid(1)">¬´</button>';
      h += '<button class="page-btn ' + (p===1?'disabled':'') + '" onclick="renderGrid(' + (p-1) + ')">‚Äπ</button>';
      let s = Math.max(1,p-2), e = Math.min(totalPages,p+2);
      if (p<=3) e=Math.min(totalPages,5);
      if (p>=totalPages-2) s=Math.max(1,totalPages-4);
      if (s>1) h+='<button class="page-btn disabled wide" style="pointer-events:none">‚Ä¶</button>';
      for (let n=s;n<=e;n++) h+='<button class="page-btn ' + (n===p?'active':'') + '" onclick="renderGrid(' + n + ')">'+ n +'</button>';
      if (e<totalPages) h+='<button class="page-btn disabled wide" style="pointer-events:none">‚Ä¶</button>';
      h += '<button class="page-btn ' + (p===totalPages?'disabled':'') + '" onclick="renderGrid(' + (p+1) + ')">‚Ä∫</button>';
      h += '<button class="page-btn wide ' + (p===totalPages?'disabled':'') + '" onclick="renderGrid(' + totalPages + ')">¬ª</button>';
      el.innerHTML = h;
    }

    renderSeasonTabs();
    renderGrid();

    // ======== PLAYER ========



  }
</script>
</body>
</html>
